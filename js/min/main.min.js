function SizeMe(e){$("body").height($(window).outerHeight()-40),$("body").width($(window).outerWidth());var t=($("body").width(),$("body").height(),0),n=151,o=49,i=60;$("#map").height($("body").height()-$("#map").offset().top),$("#menu").height($("#map").height()-t),$("#vcr-controls").css("top",$("#map").offset().top+$("#map").height()-o-i+"px"),$("#SubjectiveMarkers").height($("#menu").height()-n),e.invalidateSize()}$(document).ready(function(){function e(e,n,o){var i=[];for(var a in e)i.push('<input type="checkbox" name="SMFilter" value="'+e[a]+'">'+e[a]+"<br><i>&nbsp; &nbsp; &nbsp;&#40;cited "+n.SMCount[e[a]]+" times&#41;</i></input>");$("#SubjectiveMarkers").html(i.join("<br />")),$("#SubjectiveMarkers").on("click",function(){t(n,o),$(".pause").hide(),$(".play").show(),p(n,o)}),$("#checkAllBtn").click(function(){$("#SubjectiveMarkers :checkbox").each(function(){this.checked=!0}),t(n,o),$(".pause").hide(),$(".play").show(),p(n,o)}),$("#uncheckAllBtn").click(function(){$("#SubjectiveMarkers :checkbox").each(function(){this.checked=!1}),t(n,o)}),$("#resetMapBtn").click(function(){S.setView([48.876,2.36],15)})}function t(e,t){k=[],$("input:checkbox[name=SMFilter]:checked").each(function(){k.push($(this).val())}),$("#checkedNum").html(k.length+" categories are checked"),o(e,t)}function n(e){var t=[],n=[],o=[],i=[],a={};for(var r in e.features){var c=e.features[r].properties;void 0===n[c.Page]&&(t.push(c.Page),n[c.Page]=1),void 0===i[c.SM]&&(o.push(c.SM),i[c.SM]=1),void 0===a[c.SM]?a[c.SM]=1:a[c.SM]+=1}return{SMs:o,pages:t.sort(function(e,t){return e-t}),SMCount:a}}function o(e,t,n){S.hasLayer(g)&&S.removeLayer(g),g=L.geoJson(t,{filter:function(e){return n?e.properties.Page==n?!0:!1:-1!==$.inArray(e.properties.SM,k)?!0:!1},pointToLayer:function(e,t){return L.circle(t,100,{fillColor:i(e.properties.SM),color:i(e.properties.SM),weight:4,fillOpacity:.2}).on({mouseover:function(){this.openPopup(),this.setStyle({color:"#000000"})},mouseout:function(){this.closePopup(),this.setStyle({color:i(e.properties.SM)})}})}}).addTo(S),a()}function i(){return"#CC2B0A"}function a(){g.eachLayer(function(e){var t=e.feature.properties,n=100,o="<i><b>"+t.SM+"</b></i> <br>"+t.Address+"<br>page "+t.Page;e.setRadius(n),e.bindPopup(o,{offset:new L.Point(0,10)}),e.options.color=i(t.SM),e.options.fillColor=i(t.SM)})}function r(e,t,n){var i=L.control({position:"bottomright"});i.onAdd=function(){var i=L.DomUtil.create("input","range-slider");return L.DomEvent.addListener(i,"mousedown",function(e){L.DomEvent.stopPropagation(e)}),$(i).attr({type:"range",max:e[e.length-1],min:e[0],step:1,width:4,value:String(e[0])}).on("input change",function(){o(t,n,this.value),$(".temporal-legend").text("On page "+this.value)}),i},i.addTo(S),f(e[0])}function c(n,o){$(".pause").hide(),$(".play").click(function(){$(".pause").show(),$(".play").hide(),S.setView([48.876,2.357],15),clearInterval(v),m=250,u(n,o,m),e(n.SMs,n,o),t()}),$(".pause").click(function(){$(".pause").hide(),$(".play").show(),p(n,o,m)}),$(".step").click(function(){p(),$(".pause").hide(),$(".play").show(),s(n,o)}),$(".back").click(function(){p(),$(".pause").hide(),$(".play").show(),l(n,o)}),$(".back-full").click(function(){p(),$(".pause").hide(),$(".play").show(),d(n,o)}),$(".step-full").click(function(){$(".pause").hide(),$(".play").show(),h(n,o)}),$(".faster").click(function(){m>100?(m-=100,clearInterval(v),u(n,o,m)):m=250}),$(".slower").click(function(){1e3>m?(m+=100,clearInterval(v),u(n,o,m),console.log(m)):m=250})}function u(e,t,n){v=setInterval(function(){s(e,t)},n)}function p(e,t,n){n=0,clearInterval(v)}function l(e,t,n){b>9&&b--,o(e,t,b,n),$("input[type=range]").val(b),$(".temporal-legend").text("On Page "+b)}function s(e,t,n){238>b&&b++,o(e,t,b,n),$("input[type=range]").val(b),$(".temporal-legend").text("On Page "+b)}function h(e,t){b=238,o(e,t,b),$("input[type=range]").val(b),$(".temporal-legend").text("On Page "+b)}function d(e,t){b=9,o(e,t,b),$("input[type=range]").val(b),$(".temporal-legend").text("On Page "+b)}function f(e){var t=L.control({position:"bottomright"});t.onAdd=function(){var e=L.DomUtil.create("output","temporal-legend");return e},t.addTo(S),$(".temporal-legend").text("On page "+e)}var g,m,v,k=[],b=9;L.mapbox.accessToken="pk.eyJ1IjoiZGVhbm9sc2VuMSIsImEiOiJ1dkxBdm9FIn0.kapau_lUukKIE93Y8I0A9g";var S=L.mapbox.map("map","deanolsen1.l4i434a2",{zoomControl:!1,attributionControl:!1});S.setView([48.876,2.357],15),new L.Control.Zoom({position:"topright"}).addTo(S),$.getJSON("data/Locationsv4.geojson").done(function(i){var a=n(i);o(a,i),r(a.pages,a,i),e(a.SMs,a,i),t(a,i),c(a,i)}).fail(function(){alert("There has been a problem loading the data.")})});